{"ast":null,"code":"import _regeneratorRuntime from\"/Users/salmon/GitSpace/study/React/nwitter/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/salmon/GitSpace/study/React/nwitter/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/salmon/GitSpace/study/React/nwitter/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{dbService,storageService}from\"fbase\";import React,{useState}from\"react\";import{v4 as uuidv4}from\"uuid\";import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import{faPlus,faTimes}from\"@fortawesome/free-solid-svg-icons\";var NweetFactory=function NweetFactory(_ref){var userObj=_ref.userObj;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),nweet=_useState2[0],setNweet=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),attachment=_useState4[0],setAttachment=_useState4[1];var onSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var attachmenteRef,attachmentUrl,response,nweetObj;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(nweet===\"\")){_context.next=2;break;}return _context.abrupt(\"return\");case 2:event.preventDefault();attachmenteRef=storageService.ref().child(\"\".concat(userObj.uid,\"/\").concat(uuidv4()));attachmentUrl=\"\";if(!(attachment!==\"\")){_context.next=12;break;}_context.next=8;return attachmenteRef.putString(attachment,\"data_url\");case 8:response=_context.sent;_context.next=11;return response.ref.getDownloadURL();case 11:attachmentUrl=_context.sent;case 12:nweetObj={text:nweet,createdAt:Date.now(),creatorId:userObj.uid,attachmentUrl:attachmentUrl};_context.next=15;return dbService.collection(\"nweets\").add(nweetObj);case 15:setNweet(\"\");setAttachment(\"\");case 17:case\"end\":return _context.stop();}}},_callee);}));return function onSubmit(_x){return _ref2.apply(this,arguments);};}();var onChange=function onChange(event){var value=event.target.value;setNweet(value);};var onFileChange=function onFileChange(event){var files=event.target.files;var theFile=files[0];var reader=new FileReader();reader.onloadend=function(finishedEvent){var result=finishedEvent.currentTarget.result;setAttachment(result);};reader.readAsDataURL(theFile);};var onClearAttachment=function onClearAttachment(){return setAttachment(\"\");};return/*#__PURE__*/React.createElement(\"form\",{onSubmit:onSubmit,className:\"factoryForm\"},/*#__PURE__*/React.createElement(\"div\",{className:\"factoryInput__container\"},/*#__PURE__*/React.createElement(\"input\",{className:\"factoryInput__input\",value:nweet,onChange:onChange,type:\"text\",placeholder:\"What's on your mind?\",maxLength:120}),/*#__PURE__*/React.createElement(\"input\",{type:\"submit\",value:\"\\u2192\",className:\"factoryInput__arrow\"})),/*#__PURE__*/React.createElement(\"label\",{for:\"attach-file\",className:\"factoryInput__label\"},/*#__PURE__*/React.createElement(\"span\",null,\"Add photos\"),/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faPlus})),/*#__PURE__*/React.createElement(\"input\",{id:\"attach-file\",type:\"file\",accept:\"image/*\",onChange:onFileChange,style:{opacity:0}}),attachment&&/*#__PURE__*/React.createElement(\"div\",{className:\"factoryForm__attachment\"},/*#__PURE__*/React.createElement(\"img\",{src:attachment,style:{backgroundImage:attachment}}),/*#__PURE__*/React.createElement(\"div\",{className:\"factoryForm__clear\",onClick:onClearAttachment},/*#__PURE__*/React.createElement(\"span\",null,\"Remove\"),/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faTimes}))));};export default NweetFactory;","map":{"version":3,"sources":["/Users/salmon/GitSpace/study/React/nwitter/src/components/NweetFactory.js"],"names":["dbService","storageService","React","useState","v4","uuidv4","FontAwesomeIcon","faPlus","faTimes","NweetFactory","userObj","nweet","setNweet","attachment","setAttachment","onSubmit","event","preventDefault","attachmenteRef","ref","child","uid","attachmentUrl","putString","response","getDownloadURL","nweetObj","text","createdAt","Date","now","creatorId","collection","add","onChange","value","target","onFileChange","files","theFile","reader","FileReader","onloadend","finishedEvent","result","currentTarget","readAsDataURL","onClearAttachment","opacity","backgroundImage"],"mappings":"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","sourcesContent":["import { dbService, storageService } from \"fbase\";\nimport React, { useState } from \"react\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faPlus, faTimes } from \"@fortawesome/free-solid-svg-icons\";\n\nconst NweetFactory = ({ userObj }) => {\n  const [nweet, setNweet] = useState(\"\");\n  const [attachment, setAttachment] = useState(\"\");\n  const onSubmit = async (event) => {\n    if (nweet === \"\") {\n      return;\n    }\n    event.preventDefault();\n    const attachmenteRef = storageService\n      .ref()\n      .child(`${userObj.uid}/${uuidv4()}`);\n\n    let attachmentUrl = \"\";\n    if (attachment !== \"\") {\n      const response = await attachmenteRef.putString(attachment, \"data_url\");\n      attachmentUrl = await response.ref.getDownloadURL();\n    }\n    const nweetObj = {\n      text: nweet,\n      createdAt: Date.now(),\n      creatorId: userObj.uid,\n      attachmentUrl,\n    };\n    await dbService.collection(\"nweets\").add(nweetObj);\n    setNweet(\"\");\n    setAttachment(\"\");\n  };\n\n  const onChange = (event) => {\n    const {\n      target: { value },\n    } = event;\n    setNweet(value);\n  };\n  const onFileChange = (event) => {\n    const {\n      target: { files },\n    } = event;\n    const theFile = files[0];\n    const reader = new FileReader();\n    reader.onloadend = (finishedEvent) => {\n      const {\n        currentTarget: { result },\n      } = finishedEvent;\n      setAttachment(result);\n    };\n    reader.readAsDataURL(theFile);\n  };\n\n  const onClearAttachment = () => setAttachment(\"\");\n  return (\n    <form onSubmit={onSubmit} className=\"factoryForm\">\n      <div className=\"factoryInput__container\">\n        <input\n          className=\"factoryInput__input\"\n          value={nweet}\n          onChange={onChange}\n          type=\"text\"\n          placeholder=\"What's on your mind?\"\n          maxLength={120}\n        />\n        <input type=\"submit\" value=\"&rarr;\" className=\"factoryInput__arrow\" />\n      </div>\n      <label for=\"attach-file\" className=\"factoryInput__label\">\n        <span>Add photos</span>\n        <FontAwesomeIcon icon={faPlus} />\n      </label>\n      <input\n        id=\"attach-file\"\n        type=\"file\"\n        accept=\"image/*\"\n        onChange={onFileChange}\n        style={{\n          opacity: 0,\n        }}\n      />\n      {attachment && (\n        <div className=\"factoryForm__attachment\">\n          <img\n            src={attachment}\n            style={{\n              backgroundImage: attachment,\n            }}\n          />\n          <div className=\"factoryForm__clear\" onClick={onClearAttachment}>\n            <span>Remove</span>\n            <FontAwesomeIcon icon={faTimes} />\n          </div>\n        </div>\n      )}\n    </form>\n  );\n};\n\nexport default NweetFactory;\n"]},"metadata":{},"sourceType":"module"}